<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>测试3019 UI + 后端数据库集成服务器</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
    .test { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
    .success { background-color: #d4edda; border-color: #c3e6cb; color: #155724; }
    .error { background-color: #f8d7da; border-color: #f5c6cb; color: #721c24; }
    .loading { background-color: #fff3cd; border-color: #ffeaa7; color: #856404; }
    button { padding: 8px 16px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background-color: #0056b3; }
    pre { background-color: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
  </style>
</head>
<body>
  <h1>测试3019 UI + 后端数据库集成服务器</h1>
  
  <div class="test" id="test1">
    <h3>1. 测试主页访问</h3>
    <button onclick="testHomepage()">测试</button>
    <div id="result1"></div>
  </div>
  
  <div class="test" id="test2">
    <h3>2. 测试API统计</h3>
    <button onclick="testStats()">测试</button>
    <div id="result2"></div>
  </div>
  
  <div class="test" id="test3">
    <h3>3. 测试搜索API</h3>
    <input type="text" id="searchQuery" value="手机" placeholder="输入搜索词">
    <button onclick="testSearch()">测试搜索</button>
    <div id="result3"></div>
  </div>
  
  <div class="test" id="test4">
    <h3>4. 测试卡片视图</h3>
    <button onclick="testGridView()">测试卡片视图</button>
    <div id="result4"></div>
  </div>
  
  <div class="test" id="test5">
    <h3>5. 测试列表视图</h3>
    <button onclick="testListView()">测试列表视图</button>
    <div id="result5"></div>
  </div>
  
  <div class="test" id="test6">
    <h3>6. 测试详情页API</h3>
    <button onclick="testCategoryDetail()">测试详情页</button>
    <div id="result6"></div>
  </div>
  
  <script>
    const baseUrl = 'http://localhost:3031';
    
    async function testHomepage() {
      const testDiv = document.getElementById('test1');
      const resultDiv = document.getElementById('result1');
      
      testDiv.className = 'test loading';
      resultDiv.innerHTML = '正在测试主页访问...';
      
      try {
        const response = await fetch(baseUrl + '/');
        if (response.ok) {
          testDiv.className = 'test success';
          resultDiv.innerHTML = '✅ 主页访问成功！HTTP状态码: ' + response.status;
        } else {
          testDiv.className = 'test error';
          resultDiv.innerHTML = '❌ 主页访问失败！HTTP状态码: ' + response.status;
        }
      } catch (error) {
        testDiv.className = 'test error';
        resultDiv.innerHTML = '❌ 主页访问出错: ' + error.message;
      }
    }
    
    async function testStats() {
      const testDiv = document.getElementById('test2');
      const resultDiv = document.getElementById('result2');
      
      testDiv.className = 'test loading';
      resultDiv.innerHTML = '正在获取统计信息...';
      
      try {
        const response = await fetch(baseUrl + '/api/stats');
        if (response.ok) {
          const data = await response.json();
          testDiv.className = 'test success';
          resultDiv.innerHTML = `
            ✅ 统计API测试成功！<br>
            <pre>${JSON.stringify(data, null, 2)}</pre>
            数据统计: ${data.data.items.toLocaleString()}个三级分类，${data.data.answers}个最佳答案
          `;
        } else {
          testDiv.className = 'test error';
          resultDiv.innerHTML = '❌ 统计API失败！HTTP状态码: ' + response.status;
        }
      } catch (error) {
        testDiv.className = 'test error';
        resultDiv.innerHTML = '❌ 统计API出错: ' + error.message;
      }
    }
    
    async function testSearch() {
      const testDiv = document.getElementById('test3');
      const resultDiv = document.getElementById('result3');
      const query = document.getElementById('searchQuery').value;
      
      testDiv.className = 'test loading';
      resultDiv.innerHTML = '正在搜索: ' + query + '...';
      
      try {
        const response = await fetch(baseUrl + '/api/search?q=' + encodeURIComponent(query));
        if (response.ok) {
          const data = await response.json();
          testDiv.className = 'test success';
          resultDiv.innerHTML = `
            ✅ 搜索API测试成功！<br>
            搜索词: "${query}"<br>
            找到 ${data.total} 个结果<br>
            显示前 ${data.results.length} 个结果:<br>
            <pre>${JSON.stringify(data.results.slice(0, 5), null, 2)}</pre>
          `;
        } else {
          testDiv.className = 'test error';
          resultDiv.innerHTML = '❌ 搜索API失败！HTTP状态码: ' + response.status;
        }
      } catch (error) {
        testDiv.className = 'test error';
        resultDiv.innerHTML = '❌ 搜索API出错: ' + error.message;
      }
    }
    
    async function testGridView() {
      const testDiv = document.getElementById('test4');
      const resultDiv = document.getElementById('result4');
      
      testDiv.className = 'test loading';
      resultDiv.innerHTML = '正在测试卡片视图...';
      
      try {
        const response = await fetch(baseUrl + '/?view=grid');
        if (response.ok) {
          testDiv.className = 'test success';
          resultDiv.innerHTML = `
            ✅ 卡片视图测试成功！<br>
            HTTP状态码: ${response.status}<br>
            内容类型: ${response.headers.get('content-type')}<br>
            <a href="${baseUrl}/?view=grid" target="_blank">点击查看卡片视图</a>
          `;
        } else {
          testDiv.className = 'test error';
          resultDiv.innerHTML = '❌ 卡片视图失败！HTTP状态码: ' + response.status;
        }
      } catch (error) {
        testDiv.className = 'test error';
        resultDiv.innerHTML = '❌ 卡片视图出错: ' + error.message;
      }
    }
    
    async function testListView() {
      const testDiv = document.getElementById('test5');
      const resultDiv = document.getElementById('result5');
      
      testDiv.className = 'test loading';
      resultDiv.innerHTML = '正在测试列表视图...';
      
      try {
        const response = await fetch(baseUrl + '/?view=list&page=1');
        if (response.ok) {
          testDiv.className = 'test success';
          resultDiv.innerHTML = `
            ✅ 列表视图测试成功！<br>
            HTTP状态码: ${response.status}<br>
            内容类型: ${response.headers.get('content-type')}<br>
            <a href="${baseUrl}/?view=list&page=1" target="_blank">点击查看列表视图</a>
          `;
        } else {
          testDiv.className = 'test error';
          resultDiv.innerHTML = '❌ 列表视图失败！HTTP状态码: ' + response.status;
        }
      } catch (error) {
        testDiv.className = 'test error';
        resultDiv.innerHTML = '❌ 列表视图出错: ' + error.message;
      }
    }
    
    async function testCategoryDetail() {
      const testDiv = document.getElementById('test6');
      const resultDiv = document.getElementById('result6');
      
      testDiv.className = 'test loading';
      resultDiv.innerHTML = '正在测试详情页API...';
      
      try {
        // 使用已知有数据的分类进行测试
        const response = await fetch(baseUrl + '/api/category/数码电子/智能手机/5G手机');
        if (response.ok) {
          const data = await response.json();
          testDiv.className = 'test success';
          resultDiv.innerHTML = `
            ✅ 详情页API测试成功！<br>
            分类: 数码电子 > 智能手机 > 5G手机<br>
            找到 ${data.totalAnswers} 个最佳答案<br>
            <pre>${JSON.stringify(data, null, 2)}</pre>
            <a href="${baseUrl}/category/数码电子/智能手机/5G手机" target="_blank">点击查看详情页</a>
          `;
        } else {
          testDiv.className = 'test error';
          resultDiv.innerHTML = '❌ 详情页API失败！HTTP状态码: ' + response.status;
        }
      } catch (error) {
        testDiv.className = 'test error';
        resultDiv.innerHTML = '❌ 详情页API出错: ' + error.message;
      }
    }
    
    // 自动运行基本测试
    window.onload = function() {
      setTimeout(testHomepage, 500);
      setTimeout(testStats, 1000);
    };
  </script>
</body>
</html>