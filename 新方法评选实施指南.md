# BestGoods新方法评选系统 - 实施指南

## 📋 概述

基于你提供的"最佳商品百科全书 - 最佳执行方案"（Python版本），我为你创建了一个**Node.js适配版本**，专门为现有的BestGoods项目优化。

### 核心优势
- ✅ **保持UI稳定** - 不改变现有页面设计
- ✅ **数据兼容** - 直接使用现有的`best-answers.json`格式
- ✅ **真实数据** - 基于真实商家品牌和具体产品型号
- ✅ **成本可控** - 每日预算管理，避免超支
- ✅ **质量保证** - 多重验证机制确保数据准确性

## 🚀 快速开始

### 1. 准备工作
```bash
# 1. 获取DeepSeek API密钥
# 访问: https://platform.deepseek.com/api_keys
# 获取你的API密钥

# 2. 设置环境变量
export DEEPSEEK_API_KEY=your_api_key_here

# 3. 进入项目目录
cd /Users/surferboy/Desktop/BestGoods
```

### 2. 一键启动
```bash
# 给启动脚本添加执行权限
chmod +x start-new-evaluation.sh

# 运行启动脚本
./start-new-evaluation.sh
```

### 3. 选择运行模式
启动脚本提供多个选项：
- **测试模式**：处理前3个品类，验证功能
- **小批量处理**：处理10个品类
- **自定义批次**：自定义批次大小和并发数

## 📁 文件说明

### 核心文件
| 文件 | 说明 |
|------|------|
| `new-method-evaluator.js` | 主评选程序，基于Python方案理念 |
| `start-new-evaluation.sh` | 一键启动脚本 |
| `monitor-progress.js` | 进度监控脚本 |
| `new-method-config.json` | 配置文件 |
| `数据清空完成报告.md` | 数据清空报告 |

### 数据文件
| 文件 | 说明 |
|------|------|
| `data/best-answers.json` | 主数据文件（2,154个品类） |
| `data/backups/` | 自动备份目录 |
| `logs/` | 运行日志目录 |

## ⚙️ 配置说明

### API配置
在`new-method-evaluator.js`中修改：
```javascript
const CONFIG = {
  DEEPSEEK_API_KEY: process.env.DEEPSEEK_API_KEY || 'your-api-key-here',
  // ... 其他配置
};
```

或通过环境变量设置：
```bash
export DEEPSEEK_API_KEY=your_actual_key
```

### 运行参数
| 参数 | 默认值 | 说明 |
|------|--------|------|
| `BATCH_SIZE` | 10 | 每批处理品类数 |
| `CONCURRENT_WORKERS` | 3 | 并发处理数 |
| `DAILY_BUDGET` | 500.0 | 每日预算（元） |
| `MAX_RETRIES` | 3 | 最大重试次数 |

## 🔧 运行命令

### 基本命令
```bash
# 1. 显示帮助
node new-method-evaluator.js --help

# 2. 测试模式（处理前3个品类）
node new-method-evaluator.js --test

# 3. 自定义批次处理
node new-method-evaluator.js --batch-size 5 --workers 2

# 4. 监控进度
node monitor-progress.js

# 5. 监控模式（实时更新）
node monitor-progress.js --watch
```

### 依赖安装
```bash
# 安装所需包
npm install axios openai

# 或使用启动脚本自动安装
./start-new-evaluation.sh
```

## 📊 处理流程

### 1. 品类画像生成
- **价格区间**：3-5个动态区间
- **评价维度**：5-8个品类特异性维度
- **AI分析**：基于DeepSeek API的智能分析

### 2. 商品评选
- **真实性验证**：确保商品真实存在
- **参数准确性**：品牌、型号、价格准确
- **评选理由**：300-500字详细说明

### 3. 质量保证
- **自动校验**：字段完整性、逻辑一致性
- **质量评分**：0-100分自动评分
- **人工审核**：低质量数据标记为需要审核

## 💰 成本控制

### 预算管理
- **每日预算**：500元（可调整）
- **品类预算**：每个品类不超过1元
- **实时监控**：处理过程中实时显示成本

### 成本估算
| 项目 | 估算值 |
|------|--------|
| 总品类数 | 2,154个 |
| 平均tokens/品类 | 5,000-8,000 |
| 总tokens估算 | 10-17百万 |
| **总成本估算** | **20-34元** |

> 注：实际成本可能因品类复杂度和API响应而异

## 🎯 预期效果

### 处理速度
- **测试阶段**：3-5品类/小时
- **优化后**：10-30品类/小时
- **完成时间**：3-7天（全部2,154个品类）

### 数据质量
- **置信度**：>80%
- **人工审核率**：<10%
- **真实性**：100%真实商品数据

### 系统集成
- **UI兼容**：完全兼容现有BestGoods界面
- **数据格式**：保持现有JSON结构
- **无缝切换**：新数据自动替换旧数据

## 🔍 质量验证

### 自动检查
```bash
# 检查处理结果
node -e "
const fs = require('fs');
const data = JSON.parse(fs.readFileSync('data/best-answers.json', 'utf8'));
const completed = data.filter(c => c.bestProducts && c.bestProducts.length > 0);
console.log('已评选品类:', completed.length);
if (completed.length > 0) {
    const sample = completed[0];
    console.log('\\n示例品类:', sample.item);
    console.log('商品数量:', sample.bestProducts.length);
    console.log('价格区间:', sample.priceRanges?.length || 0);
    console.log('评价维度:', sample.dimensions?.length || 0);
}
"
```

### 人工抽查
建议随机抽查5-10个品类的评选结果：
1. 验证商品真实性
2. 检查价格准确性
3. 评估评选理由合理性

## 🚨 故障排除

### 常见问题
1. **API密钥错误**
   ```
   ❌ 错误: 请设置DeepSeek API密钥
   ```
   **解决**：设置正确的API密钥

2. **依赖安装失败**
   ```
   ❌ 依赖安装失败
   ```
   **解决**：手动安装 `npm install axios openai`

3. **内存不足**
   ```
   FATAL ERROR: Reached heap limit
   ```
   **解决**：减小批次大小 `--batch-size 5`

4. **API限流**
   ```
   ❌ API调用失败: Rate limit exceeded
   ```
   **解决**：增加间隔时间，减小并发数

### 日志查看
```bash
# 查看最新日志
ls -la logs/*.json | tail -5

# 查看具体日志内容
cat logs/evaluation-最新时间戳.json | jq .
```

## 📈 进度监控

### 实时监控
```bash
# 启动监控面板
node monitor-progress.js --watch
```

### 关键指标
- **品类进度**：完成/总数
- **处理速度**：品类/小时
- **成本统计**：今日花费/预算
- **质量指标**：成功率、平均评分

## 🔄 自动化部署

### 定期运行
```bash
# 每日自动处理（使用cron）
0 2 * * * cd /Users/surferboy/Desktop/BestGoods && node new-method-evaluator.js --batch-size 20 >> logs/cron.log 2>&1
```

### 进程管理
```bash
# 使用PM2管理（推荐）
npm install -g pm2
pm2 start new-method-evaluator.js --name bestgoods-evaluator
pm2 save
pm2 startup
```

## 🎉 成功标准

### 短期目标（1周内）
- [ ] 完成前100个品类评选
- [ ] 验证数据质量
- [ ] 优化处理参数
- [ ] 建立监控体系

### 中期目标（1月内）
- [ ] 完成全部2,154个品类
- [ ] 实现自动化运行
- [ ] 集成到生产环境
- [ ] 建立质量审核流程

### 长期目标
- [ ] 24小时自动化运行
- [ ] 定期数据更新
- [ ] 用户反馈收集
- [ ] 持续优化算法

## 📞 技术支持

### 文档资源
- 本指南：`新方法评选实施指南.md`
- 配置文件：`new-method-config.json`
- 代码注释：各JS文件中的详细注释

### 问题反馈
如遇问题，请检查：
1. API密钥是否正确
2. 依赖是否安装
3. 数据文件是否存在
4. 查看错误日志

### 下一步
1. **立即开始**：运行 `./start-new-evaluation.sh`
2. **测试验证**：先处理少量品类验证效果
3. **逐步扩展**：确认质量后扩大处理规模
4. **生产部署**：集成到现有BestGoods系统

---

**🚀 现在就开始吧！运行 `./start-new-evaluation.sh` 启动新方法评选系统。**

*最后更新: 2026年2月19日 00:30*